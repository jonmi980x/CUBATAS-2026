<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¹ Cubatas 2026</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
// MOSTRAR REGISTRO EN LA APP
db.ref("registro").limitToLast(30).on("value", snap => {
  const contenedor = document.getElementById("registro");
  contenedor.innerHTML = "";

  const data = snap.val();
  if (!data) return;

  const eventos = [];

  Object.entries(data).forEach(([fecha, items]) => {
    Object.values(items).forEach(e => {
      eventos.push({
        fecha,
        nombre: e.nombre,
        puntos: e.puntos
      });
    });
  });

  // Ãšltimos primero
  eventos.reverse().forEach(e => {
    const div = document.createElement("div");
    div.style.marginBottom = "6px";
    div.innerHTML = `ğŸ“… ${e.fecha} â€” <strong>${e.nombre}</strong> â€” <strong>+${e.puntos}</strong>`;
    contenedor.appendChild(div);
  });
});
<style>
body{
  font-family: system-ui, sans-serif;
  background:#0f172a;
  color:white;
  margin:0;
  padding:16px;
}
h1,h2{text-align:center}
.row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#1e293b;
  padding:10px;
  border-radius:12px;
  margin-bottom:8px;
}
.name{font-weight:bold;width:90px}
button{
  border:none;
  border-radius:8px;
  padding:6px 10px;
  margin-left:4px;
  cursor:pointer;
}
.pts{margin-left:6px;font-weight:bold}
</style>
</head>

<body>

<h1>ğŸ¹ Cubatas 2026</h1>
<h2>ğŸ—“ï¸ Recuento</h2>

<div id="app"></div>
<h2>ğŸ“œ Registro</h2>
<div id="registro"></div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyC2O75FYQDljmMeu36yB94KbOmAZdgX4d4",
  authDomain: "cubatas-2026.firebaseapp.com",
  databaseURL: "https://cubatas-2026-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "cubatas-2026",
  storageBucket: "cubatas-2026.firebasestorage.app",
  messagingSenderId: "754889583450",
  appId: "1:754889583450:web:aa584f7a906290beffe163",
  measurementId: "G-WZGVRDT8V1"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ================= PERSONAS ================= */
const people = [
  "Jonmi","Llorden","Marce","Lucho","Markitos",
  "Boveda","Diego","Bipo","Wichi","Ferrer","Rabu"
];

/* ================= FECHA ================= */
function fechaHoy(){
  return new Date().toISOString().slice(0,10); // YYYY-MM-DD
}

/* ================= PUNTOS ================= */
function puntosPorBebida(tipo){
  if(tipo==="cubata") return 5;
  if(tipo==="cana") return 1;
  if(tipo==="chupito") return 2;
  return 0;
}

function puntosTotales(d){
  return d.cubata*5 + d.cana*1 + d.chupito*2;
}

/* ================= REGISTRO ================= */
function guardarEvento(nombre,tipo){
  const evento = {
    fecha: fechaHoy(),
    nombre: nombre,
    puntos: puntosPorBebida(tipo)
  };
  db.ref("registro/" + fechaHoy()).push(evento);
}

/* ================= INICIALIZAR ================= */
people.forEach(name=>{
  db.ref("users/"+name).once("value",snap=>{
    if(!snap.exists()){
      db.ref("users/"+name).set({
        cubata:0,
        cana:0,
        chupito:0
      });
    }
  });
});

/* ================= SUMAR / RESTAR ================= */
function add(name,tipo){
  db.ref(`users/${name}/${tipo}`)
    .transaction(v => (v||0)+1, () => {
      guardarEvento(name,tipo);
    });
}

function sub(name,tipo){
  db.ref(`users/${name}/${tipo}`)
    .transaction(v => v>0 ? v-1 : 0);
}

/* ================= RENDER ================= */
db.ref("users").on("value",snap=>{
  const data = snap.val() || {};
  const app = document.getElementById("app");
  app.innerHTML = "";

  Object.entries(data).forEach(([name,d])=>{
    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `
      <div class="name">${name}</div>
      <div>
        <button onclick="add('${name}','cubata')">ğŸ¹ ${d.cubata}</button>
        <button onclick="sub('${name}','cubata')">âˆ’</button>
        <button onclick="add('${name}','cana')">ğŸº ${d.cana}</button>
        <button onclick="sub('${name}','cana')">âˆ’</button>
        <button onclick="add('${name}','chupito')">ğŸ¥ƒ ${d.chupito}</button>
        <button onclick="sub('${name}','chupito')">âˆ’</button>
        <span class="pts">${puntosTotales(d)} pts</span>
      </div>
    `;
    app.appendChild(row);
  });
});
</script>

</body>
</html>

